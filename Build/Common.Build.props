<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemDefinitionGroup>
    <ClCompile>
      <PreprocessorDefinitions>%(PreprocessorDefinitions);NOMINMAX;USE_EDGEMODE_JSRT</PreprocessorDefinitions>
      <!-- Some of our STDMETHOD can throw
           TODO: Code review STDMETHOD and separate out API that can throw and those that can't -->
      <PreprocessorDefinitions>%(PreprocessorDefinitions);COM_STDMETHOD_CAN_THROW</PreprocessorDefinitions>
      
      <!-- /W4 -->
      <WarningLevel>Level4</WarningLevel>
      <!-- /WX -->
      <TreatWarningAsError>true</TreatWarningAsError>
      <!-- /GR- -->
      <RuntimeTypeInfo>false</RuntimeTypeInfo>
      <!-- /Zi -->
      <DebugInformationFormat>ProgramDatabase</DebugInformationFormat>
      <!-- /EHsc- -->
      <ExceptionHandling>SyncCThrow</ExceptionHandling>
      <!-- TODO: clean up 4267 -->
      <DisableSpecificWarnings>4100;4127;4267;4481</DisableSpecificWarnings>
      <!-- /Gz -->
      <CallingConvention Condition="'$(Platform)'=='Win32'">StdCall</CallingConvention>
      <!-- /Zp8 -->
      <StructMemberAlignment>8Bytes</StructMemberAlignment>
      <!-- /GS -->
      <BufferSecurityCheck>true</BufferSecurityCheck>
      <!-- /Gy -->
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <!-- /GF -->
      <StringPooling>true</StringPooling>
      <!-- /MD -->
      <RuntimeLibrary>MultiThreadedDLL</RuntimeLibrary>
      <!-- We don't use any metadata -->
      <AdditionalUsingDirectories />

      <AdditionalOptions>%(AdditionalOptions) /Zm160</AdditionalOptions>
      <AdditionalOptions>%(AdditionalOptions) /Yl$(TargetName)</AdditionalOptions>
      <!-- Separate global variable for linker -->
      <AdditionalOptions>%(AdditionalOptions) /Gw</AdditionalOptions>    

      <ProgramDataBaseFileName Condition="'$(ConfigurationType)'=='StaticLibrary'">$(IntDir)$(TargetName).pdb</ProgramDataBaseFileName>
      <ProgramDataBaseFileName Condition="'$(ConfigurationType)'!='StaticLibrary'">$(IntDir)</ProgramDataBaseFileName>
    </ClCompile>
    <MASM>
      <!-- /Cx -->
      <PreserveIdentifierCase>3</PreserveIdentifierCase>    
    </MASM>    
    <Link>
      <TreatLinkerWarningAsErrors>true</TreatLinkerWarningAsErrors>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <EnableCOMDATFolding Condition="'$(OptimiziedBuild)'=='true'">true</EnableCOMDATFolding>
      <OptimizeReferences Condition="'$(OptimiziedBuild)'=='true'">true</OptimizeReferences>

      <MinimumRequiredVersion Condition="'$(NtTargetVersion)'=='$(NtTargetVersion_Win7)'" >6.1</MinimumRequiredVersion>
      <MinimumRequiredVersion Condition="'$(NtTargetVersion)'=='$(NtTargetVersion_Win8)'" >6.2</MinimumRequiredVersion>
      <MinimumRequiredVersion Condition="'$(NtTargetVersion)'=='$(NtTargetVersion_Win10)'" >10.00</MinimumRequiredVersion>

      <!-- Always set the checksum -->
      <AdditionalOptions>%(AdditionalOptions) /release</AdditionalOptions>
    </Link>
  </ItemDefinitionGroup>
  <!-- chk build flags -->
  <ItemDefinitionGroup Condition="'$(OptimiziedBuild)'!='true'">
    <ClCompile>
      <!-- ========= From inetcore\jscript\project.mk ========= -->
      <Optimization>Disabled</Optimization>
      <PreprocessorDefinitions>%(PreprocessorDefinitions);_DEBUG;DBG;DBG_DUMP</PreprocessorDefinitions>
    </ClCompile>
    <ResourceCompile>
      <PreprocessorDefinitions>%(PreprocessorDefinitions);DBG</PreprocessorDefinitions>
    </ResourceCompile>
  </ItemDefinitionGroup>
  <!-- fre and fretest build flags -->
  <ItemDefinitionGroup Condition="'$(OptimiziedBuild)'=='true'">
    <ClCompile>
      <!-- ========= From inetcore\jscript\project.mk ========= -->
      <PreprocessorDefinitions>%(PreprocessorDefinitions);NDEBUG</PreprocessorDefinitions>
      <PreprocessorDefinitions Condition="'$(Configuration)'=='Test'">%(PreprocessorDefinitions);ENABLE_DEBUG_CONFIG_OPTIONS=1</PreprocessorDefinitions>
      <Optimization>MaxSpeed</Optimization>
      <WholeProgramOptimization>true</WholeProgramOptimization>
    </ClCompile>
  </ItemDefinitionGroup>
  <ItemGroup Condition="'$(ConfigurationType)'=='DynamicLibrary' OR '$(ConfigurationType)'=='Application'">
    <Clean Include="$(OutDir)$(TargetName).lib" />
    <Clean Include="$(OutDir)$(TargetName).exp" />
    <Clean Include="$(OutDir)$(TargetName).ipdb" />
    <Clean Include="$(OutDir)$(TargetName).iobj" />
  </ItemGroup>
</Project> 
